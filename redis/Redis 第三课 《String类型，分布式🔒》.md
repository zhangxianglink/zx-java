## Redis ç¬¬ä¸‰è¯¾ ã€ŠStringç±»å‹ï¼Œåˆ†å¸ƒå¼ğŸ”’ã€‹

**åŸºæœ¬æ“ä½œ**

```shell
# åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨
127.0.0.1:6379> exists key
(integer) 1  å­˜åœ¨ä¸º1
127.0.0.1:6379> exists key2
(integer) 0  ä¸å­˜åœ¨ä¸º0
# è·å–å­—ç¬¦ä¸²é•¿åº¦
127.0.0.1:6379> strlen key
(integer) 11
# å¤´éƒ¨æ·»åŠ æ•°æ®
127.0.0.1:6379> get lol
"jacklove"
127.0.0.1:6379> append lol " is ad"
(integer) 14
127.0.0.1:6379> get lol
"jacklove is ad"
# æŒ‡å®šä½ç½®,æ›¿æ¢å­—ç¬¦ä¸²
127.0.0.1:6379> setrange lol 12 "adc"
(integer) 15
127.0.0.1:6379> get lol
"jacklove is adc"
# è·å–æ•°æ®æŒ‡å®šé•¿åº¦
127.0.0.1:6379> getrange lol 0 -1  
"jacklove is adc" å…¨éƒ¨é•¿åº¦
127.0.0.1:6379> getrange lol 12 15
"adc"  æŒ‡å®šé•¿åº¦æˆªå–
```

**è‡ªå¢è®¡æ•°å™¨**

```shell
# è®¾ç½®åˆå§‹key
127.0.0.1:6379> set wink:num 0
# åŠ ä¸€æ“ä½œ
27.0.0.1:6379> incr wink:num
(integer) 1
127.0.0.1:6379> incr wink:num
(integer) 2
127.0.0.1:6379> incr wink:num
(integer) 3
# å‡ä¸€æ“ä½œ
127.0.0.1:6379> decr wink:num
(integer) 1
127.0.0.1:6379> decr wink:num
(integer) 0
127.0.0.1:6379> decr wink:num
(integer) -1
# è®¾ç½®æ­¥é•¿æ“ä½œ, å¯ä»¥è®¾ç½®è´Ÿå€¼
127.0.0.1:6379> decrby wink:num -1000
(integer) 1096
127.0.0.1:6379> incrby wink:num -200
(integer) 896
```

**å¤šå€¼æ“ä½œ**

```shell
# many set 
127.0.0.1:6379> mset k1 "will " k2 "love " k3 "dream"
# many get æœ‰åºè¿”å›
127.0.0.1:6379> mget k2 k1 k3
1) "love "
2) "will "
3) "dream" 
# many set  if not exits
127.0.0.1:6379> msetnx  k1 "llll" k5 "happy"
(integer) 0
127.0.0.1:6379> mget k1 k2 k3
1) "will"
2) "love "
3) "happy"
k5 ä¸å­˜åœ¨å¯¼è‡´æ‰€æœ‰ä¿®æ”¹å¤±è´¥ï¼Œmsetnxæ“ä½œå…·æœ‰åŸå­æ€§ã€‚
```

**è¿‡æœŸæ—¶é—´ï¼Œåˆ†å¸ƒå¼é”**

[æ‹“å±•](https://mp.weixin.qq.com/s/X2yJlbnWSR3eOQe4ayy3Yg)

æ¡ç”°èºçš„å°ç”·å­©å…¬ä¼—å·

```shell
# è®¾ç½®è¿‡æœŸæ—¶é—´ set with expire
127.0.0.1:6379> SETEX key 60 "jack"
# å¦‚æœå­˜åœ¨ä¸åšä¿®æ”¹ set if not exits
127.0.0.1:6379> SETNX key "999"
(integer) 1  
127.0.0.1:6379> SETNX key "ooo"
(integer) 0
127.0.0.1:6379> set key "pp" æ­£å¸¸ä¿®æ”¹
OK
# ä»¥ä¸Šä¸¤è€…ç»“åˆï¼Œå®ç°åˆ†å¸ƒå¼é”
ğŸ”’éœ€è¦æ»¡è¶³çš„åŸºæœ¬æ“ä½œï¼š åŠ é”ï¼Œ è§£é”ï¼Œ é”è¶…æ—¶
äº’æ–¥æ€§: è¯æ˜èµ„æºå·²ç»æ”¶åˆ°ä¿æŠ¤ï¼Œéœ€è¦ç­‰å¾…
ä¸æ­»é”ï¼šä¸ºé¿å…æ­»é”ï¼Œåœ¨è§„å®šå•ä½æ—¶é—´ç»“æŸåæ”¾å¼€èµ„æºã€‚
å¯é‡å…¥ï¼šå¯¹åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥å¤šæ¬¡é‡å¤åŠ é”ã€‚
SETEX,SETNX å°†åŠ é”ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´åˆ†æˆä¸¤æ­¥ï¼Œå› ä¸ºä¸æ˜¯åŸå­æ€§æ“ä½œï¼Œå®¹æ˜“å¼•å‘æ­»é”é—®é¢˜,æ‰€ä»¥æœ‰äº†æ–°å‘½ä»¤ã€‚
127.0.0.1:6379> set mylock "power" ex 60 nx
EX secondsï¼šä»¥ç§’ä¸ºå•ä½è®¾ç½®è¿‡æœŸæ—¶é—´
PX millisecondsï¼šä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½®è¿‡æœŸæ—¶é—´
EXAT timestampï¼šè®¾ç½®ä»¥ç§’ä¸ºå•ä½çš„UNIXæ—¶é—´æˆ³æ‰€å¯¹åº”çš„æ—¶é—´ä¸ºè¿‡æœŸæ—¶é—´
PXAT milliseconds-timestampï¼šè®¾ç½®ä»¥æ¯«ç§’ä¸ºå•ä½çš„UNIXæ—¶é—´æˆ³æ‰€å¯¹åº”çš„æ—¶é—´ä¸ºè¿‡æœŸæ—¶é—´
NXï¼šé”®ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®é”®å€¼
XXï¼šé”®å­˜åœ¨çš„æ—¶å€™è®¾ç½®é”®å€¼
KEEPTTLï¼šä¿ç•™è®¾ç½®å‰æŒ‡å®šé”®çš„ç”Ÿå­˜æ—¶é—´

ä½†æ˜¯ä¾æ—§å­˜åœ¨é—®é¢˜ï¼Œ1.é”è¿‡æœŸäº†ï¼Œä¸šåŠ¡è¿˜åœ¨æ‰§è¡Œ
               2. é”è¿‡æœŸäº†ï¼Œè¢«å…¶ä»–äººå ç”¨ï¼Œä½ ä¸šåŠ¡å®Œæˆäº†ï¼ŒæŠŠé”å¹²æ‰äº†

è§£å†³æ–¹æ¡ˆï¼šç»™é”ä¸€ä¸ªï¼Œéšæœºæ•°å­—åšvalueï¼Œè§£é”ä¹‹å‰åšä¸€ä¸‹åˆ¤æ–­ï¼ˆä¸ºä¿éšœåˆ¤æ–­+è§£é”çš„åŸå­æ€§ lua è„šæœ¬å®ç°ï¼‰
ä¸Šè¿°æ–¹æ¡ˆè§£å†³äº†ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¼•å…¥redisson,åŠ é”æˆåŠŸåå°±ä¼šå¼€å¯ä¸€ä¸ªåå°çº¿
ç¨‹æ£€æŸ¥åŠ é”çš„æƒ…å†µï¼Œè¿™æ ·è§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚

ä»¥ä¸Šæ–¹æ¡ˆéƒ½æ˜¯åŸºäºå•æœºéƒ¨ç½²ï¼Œé›†ç¾¤ä¸‹ä½¿ç”¨redlockæ–¹æ¡ˆã€‚


# getset
127.0.0.1:6379> getset key1 "hello"
(nil)
127.0.0.1:6379> getset key1 "world"
"hello"
```

**å¤æ‚æ•°æ®å½¢å¼**

```shell
# json
127.0.0.1:6379[3]> SET obj '{"user":1,"name":"jack"}'
OK
127.0.0.1:6379[3]> get obj
"{\"user\":1,\"name\":\"jack\"}"
# ç»“æ„åŒ–æ•°æ® user:{id}:{filed}
127.0.0.1:6379[3]> set user:1:name jack
OK
127.0.0.1:6379[3]> set user:1:age 21
OK
127.0.0.1:6379[3]> get user:1:age
"21"
127.0.0.1:6379[3]> get user:1:name
"jack"
```

